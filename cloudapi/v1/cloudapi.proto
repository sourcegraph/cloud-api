syntax = "proto3";

package cloudapi.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/sourcegraph/cloud-api/go/cloudapi/v1;cloudapiv1";

message ListInstancesRequest {
  string slug = 1;
  string status = 2;
}

message ListInstancesResponse {
  repeated Instance instances = 1;
  InstanceDrift drift = 2;
}

message Instance {
  string id = 1;
  string project_name = 2;
  string type = 3;
  ProjectDetails project_details = 4;
  InstanceDetails instance_details = 5;
  string status = 6;
}

message InstanceDrift {
  repeated Instance only_repo = 1;
  repeated Instance only_project = 2;
}

message ProjectDetails {
  string project_id = 1;
  bool is_deleted = 4;
  google.protobuf.Timestamp created_at = 5;
}

message InstanceDetails {
  string url = 6;
  string email_domain = 2;
  string instance_type = 3;
}

service InstanceService {
  rpc ListInstances(ListInstancesRequest) returns (ListInstancesResponse) {}
  rpc CreateOrUpdateInstance(CreateOrUpdateInstanceRequest) returns (CreateOrUpdateInstanceResponse) {}
  rpc GetInstance(GetInstanceRequest) returns (GetInstanceResponse) {}
}

// cloud deploy my branch part
message CreateOrUpdateInstanceRequest {
  string branch_name = 1;
  string admin_email = 2;
}

message CreateOrUpdateInstanceResponse {
  Instance instance = 1;
}

message GetInstanceRequest {
  string slug = 1;
}

message GetInstanceResponse {
  Instance instance = 1;
}
